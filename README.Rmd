---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
stopifnot(require(knitr))
options(width = 90)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/",
  out.width = "100%"
)
```

```{r, echo = FALSE}
version <- as.vector(read.dcf("DESCRIPTION")[, "Version"])
version <- gsub("-", ".", version)
```

# envPred <img src="man/figures/logo.png" width = 180 alt="envPred Logo" align="right" />

<!-- badges: start -->
[![lifecycle](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![R build status](https://github.com/dbarneche/envPred/workflows/R-CMD-check/badge.svg)](https://github.com/dbarneche/envPred/actions)
[![Travis-CI Build Status](http://badges.herokuapp.com/travis/dbarneche/envPred?branch=master&env=BUILD_NAME=trusty_release&label=linux)](https://travis-ci.org/dbarneche/envPred)
[![Build Status](http://badges.herokuapp.com/travis/dbarneche/envPred?branch=master&env=BUILD_NAME=osx_release&label=osx)](https://travis-ci.org/dbarneche/envPred)
[![Codecov test coverage](https://codecov.io/gh/dbarneche/envPred/branch/master/graph/badge.svg)](https://codecov.io/gh/dbarneche/envPred?branch=master)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/dbarneche/envPred?branch=master&svg=true)](https://ci.appveyor.com/project/dbarneche/envPred)
![pkgdown](https://github.com/dbarneche/envPred/workflows/pkgdown/badge.svg)
[![packageversion](https://img.shields.io/badge/Package%20version-`r version`-orange.svg)](commits/master)
[![license](https://img.shields.io/badge/license-GPL--2-blue.svg)](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html)
<!-- badges: end -->

`envPred` is an R package that calculates two components of environmental predictability out of environmental time series (e.g. temperature, productivity, rainfall, etc.).

## Installation

The `envPred` package can be installed from github using the [`devtools`](https://cran.r-project.org/web/packages/devtools/index.html) package using `devtools::install_github`.

If you do not yet have `devtools`, install with `install.packages("devtools")`.

Then install `envPred` using the following:  
`library(devtools)`  
`install_github("dbarneche/envPred")`  
`library(envPred)`

## Examples

```{r, message = FALSE}
library(envPred)
```

First, we recommend carefully reading the help page for the main functions

```{r, eval = FALSE}
?predictability
?colwell74
```

To calculate seasonality and colour of environmental noise using sample data (temporally even SST data):

```{r}
sst_pred <- predictability(sst$time_series, sst$dates, delta = 1,
                           is_uneven = FALSE, interpolate = FALSE,
                           show_warns = TRUE, noise_method = "spectrum")
```

The package threw a warning, which can be addressed in this example by:

```{r, warnings = FALSE}
sst  <-  sst[sst$dates <= as.Date("2007-01-01"), ]
sst_pred <- predictability(sst$time_series, sst$dates, delta = 1,
                           is_uneven = FALSE, interpolate = FALSE,
                           show_warns = TRUE, noise_method = "spectrum")
```

The data can be plotted using [`ggplot2`](https://ggplot2.tidyverse.org/) methods:

```{r}
gg_pred(sst_pred, type = "detrended")
```

```{r}
gg_pred(sst_pred, type = "spectral") +
  coord_trans(x = "log10", y = "log10")
```

Finally, the package also handles temporally uneven NPP data
with NAs (carefully check warnings), by using the Lomb-Scargle Periodogram from package
[`lomb`](https://cran.r-project.org/web/packages/lomb/index.html).

```{r, warning = FALSE}
npp_pred  <-  predictability(npp$time_series, npp$dates, delta = 8,
                             is_uneven = TRUE, interpolate = TRUE,
                             show_warns = TRUE, noise_method = "lomb_scargle")
```

## Available data sources in envPred

The following sample data were obtained using the [noaaErddap](https://github.com/dbarneche/noaaErddap/) R package:

* [Net Primary Productivity (NPP) data](http://coastwatch.pfeg.noaa.gov/erddap/griddap/erdPPbfp18day.html)
* [Sea Surface Temperature (SST)](http://www.esrl.noaa.gov/psd/data/gridded/data.noaa.oisst.v2.highres.html)

## Authors

Dr. Diego Barneche (Australian Institute of Marine Science) and Dr. Scott Burgess (Florida State University Tallahassee)

## Bug reporting

Please [report any issues or bugs](https://github.com/dbarneche/envPred/issues).
